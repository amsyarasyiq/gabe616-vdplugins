(function(I,A,d,t,m,T,u,R,g,S,G){"use strict";const{TextStyleSheet:V}=d.findByProps("TextStyleSheet"),{View:ae,Text:x,Pressable:ie}=R.General;d.find(function(e){return e.render?.name==="ActionSheet"}),d.findByProps("openLazy","hideActionSheet"),d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function k(e){const n=d.findByProps("colors","meta"),r=d.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(r.theme,e)}var D;(function(e){function n(c){let{children:o,onPress:i}=c;return t.React.createElement(H,{variant:"text-md/bold",onPress:i},o)}e.Bold=n;function r(c){let{children:o,onPress:i}=c;return t.React.createElement(x,{style:{textDecorationLine:"underline"},onPress:i},o)}e.Underline=r})(D||(D={}));function H(e){let{variant:n,lineClamp:r,color:c,align:o,style:i,onPress:p,getChildren:f,children:P,liveUpdate:v}=e;const[w,N]=t.React.useReducer(function(a){return~a},0),s=new Date().setMilliseconds(1e3);return v&&setTimeout(function(){return N()},s-Date.now()),t.React.createElement(x,{style:[n?V[n]:{},c?{color:k(g.semanticColors[c])}:{},o?{textAlign:o}:{},i??{}],numberOfLines:r,onPress:p},f?.()??P)}function B(e){let{onPress:n,icon:r,style:c,destructive:o}=e;const i=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:g.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:g.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:g.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n},t.React.createElement(t.ReactNative.Image,{style:[typeof c=="string"?c==="header"?i.headerStyleIcon:i.cardStyleIcon:c,o&&i.destructiveIcon].filter(function(p){return!!p}),source:r}))}const{FormRow:C}=R.Forms,b=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:g.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:g.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function j(e){const[,n]=t.React.useReducer(function(r){return~r},0);return t.React.createElement(t.ReactNative.View,{style:[b.card,{marginBottom:10}]},t.React.createElement(C,{style:b.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement(C.Icon,{source:e.headerIcon})}),t.React.createElement(C,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:b.actions},e.actions?.().map(function(r){let{icon:c,onPress:o,destructive:i}=r;return t.React.createElement(B,{icon:c,onPress:function(){o(function(){return n()})},style:"card",destructive:i??!1})}))}))}const{showSimpleActionSheet:X}=d.findByProps("showSimpleActionSheet"),{TextStyleSheet:L}=d.findByProps("TextStyleSheet"),O=t.stylesheet.createThemedStyleSheet({text:{...L["text-md/medium"],color:g.semanticColors.TEXT_NORMAL},link:{...L["text-md/bold"],color:g.semanticColors.TEXT_LINK}}),{Text:F,View:z}=R.General;var h;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(h||(h={}));function K(){const e={},[n,r]=t.React.useState(!1),[c,o]=t.React.useState(h.Newest),[i,p]=t.React.useState({}),[f,P]=t.React.useState("");t.React.useEffect(function(){P(""),o(h.Newest)},[]);const v=t.NavigationNative.useNavigation();!i.parsed&&!n&&(r(!0),T.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(s){return s.json()}).then(function(s){p({parsed:s}),r(!1)}));const w=v.addListener("focus",function(){w(),v.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(z,{style:{flexDirection:"row-reverse"}},t.React.createElement(B,{onPress:function(){return!n&&p({parsed:void 0})},icon:u.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(B,{onPress:function(){return!n&&X({key:"CardOverflow",options:Object.values(h).map(function(s){return{label:s,onPress:function(){return o(s)}}})})},icon:u.getAssetIDByName("ic_filter"),style:"header"}))}})});if(n||!i.parsed)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let N=i.parsed.filter(function(s){return s.name?.toLowerCase().includes(f)||s.authors?.some(function(a){return a.name?.toLowerCase().includes(f)})||s.description?.toLowerCase().includes(f)});return[h.Alphabetical,h.ReverseAlphabetical].includes(c)&&(N=N.sort(function(s,a){return s.name<a.name?-1:s.name>a.name?1:0})),[h.ReverseAlphabetical,h.Newest].includes(c)&&N.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(R.Search,{style:{marginBottom:10},onChangeText:function(s){return P(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:N,renderItem:function(s){let{item:a,index:ne}=s;return t.React.createElement(j,{index:ne,headerLabel:t.React.createElement(F,{style:O.text},a.name,a.authors[0]&&" by ",...a.authors.map(function(l,E,y){return t.React.createElement(t.React.Fragment,null,t.React.createElement(F,{onPress:function(){return $(l.id)},style:O.link},l.name),E!==y.length-1&&", ")})),headerIcon:u.getAssetIDByName(a.vendetta.icon),descriptionLabel:a.description,actions:function(){const l=`https://vd-plugins.github.io/proxy/${a.vendetta.original}`,E=G.plugins.plugins[l];return E?[E.manifest.hash!==a.hash&&{icon:u.getAssetIDByName("ic_sync_24px"),onPress:async function(y){if(!e[l]){e[l]=!0;try{await U(l),S.showToast(`Successfully updated ${a.name}.`,u.getAssetIDByName("ic_sync_24px"))}catch{S.showToast(`Failed to update ${a.name}!`,u.getAssetIDByName("Small"))}delete e[l],y()}}},{icon:u.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(y){if(!e[l]){e[l]=!0;try{A.removePlugin(l),S.showToast(`Successfully deleted ${a.name}.`,u.getAssetIDByName("ic_message_delete"))}catch{S.showToast(`Failed to delete ${a.name}!`,u.getAssetIDByName("Small"))}delete e[l],y()}}}].filter(function(y){return!!y}):[{icon:u.getAssetIDByName("ic_download_24px"),onPress:async function(y){if(!e[l]){e[l]=!0;try{await A.installPlugin(l),S.showToast(`Successfully installed ${a.name}.`,u.getAssetIDByName("toast_image_saved"))}catch(re){S.showToast(re?.message??`Failed to install ${a.name}!`,u.getAssetIDByName("Small"))}delete e[l],y()}}}]}})}})}const{FormRow:_}=R.Forms;function Y(){const e=t.NavigationNative.useNavigation();return React.createElement(R.ErrorBoundary,null,React.createElement(_,{label:"Plugin Browser",leading:React.createElement(_.Icon,{source:u.getAssetIDByName("ic_search_items_24px")}),trailing:_.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:K})}}))}const{FormSection:W}=R.Forms,q=d.findByName("UserSettingsOverviewWrapper",!1);function J(){let e=[],n=m.after("default",q,function(r,c){n();const o=T.findInReactTree(c.props.children,function(i){return i.type&&i.type.name==="UserSettingsOverview"});e.push(m.after("render",o.type.prototype,function(i,p){let{props:{children:f}}=p;const P=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];f=T.findInReactTree(f,function(w){return w.children[1].type===W}).children;const v=f.findIndex(function(w){return P.includes(w?.props.label)});f.splice(v===-1?4:v,0,React.createElement(Y,null))}))},!0);return function(){return e.forEach(function(r){return r()})}}const Q=d.findByStoreName("UserStore"),{showUserProfile:Z}=d.findByProps("showUserProfile"),{fetchProfile:ee}=d.findByProps("fetchProfile");async function U(e){const n=e.enabled;for(let r=0;r<2;r++)n&&A.stopPlugin(e.id,!1),await A.fetchPlugin(e.id),n&&await A.startPlugin(e.id)}async function $(e){Q.getUser(e)||await ee(e),Z({userId:e})}let M;var te={onLoad:function(){return M=J()},onUnload:function(){return M?.()}};return I.default=te,I.openProfile=$,I.refetchPlugin=U,Object.defineProperty(I,"__esModule",{value:!0}),I})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.ui.toasts,vendetta);
