(function(N,w,f,t,_,T,u,v,p,G,S){"use strict";const{TextStyleSheet:V}=f.findByProps("TextStyleSheet"),{View:re,Text:x,Pressable:ae}=v.General;function k(e){const n=f.findByProps("colors","meta"),r=f.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(r.theme,e)}var D;(function(e){function n(l){let{children:o,onPress:i}=l;return t.React.createElement(j,{variant:"text-md/bold",onPress:i},o)}e.Bold=n;function r(l){let{children:o,onPress:i}=l;return t.React.createElement(x,{style:{textDecorationLine:"underline"},onPress:i},o)}e.Underline=r})(D||(D={}));function j(e){let{variant:n,lineClamp:r,color:l,align:o,style:i,onPress:R,getChildren:d,children:P,liveUpdate:I}=e;const[y,s]=t.React.useReducer(function(m){return~m},0),a=new Date().setMilliseconds(1e3);return I&&setTimeout(function(){return s()},a-Date.now()),t.React.createElement(x,{style:[n?V[n]:{},l?{color:k(p.semanticColors[l])}:{},o?{textAlign:o}:{},i??{}],numberOfLines:r,onPress:R},d?.()??P)}function A(e){let{onPress:n,icon:r,style:l,destructive:o}=e;const i=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:p.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:p.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:p.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n},t.React.createElement(t.ReactNative.Image,{style:[typeof l=="string"?l==="header"?i.headerStyleIcon:i.cardStyleIcon:l,o&&i.destructiveIcon].filter(function(R){return!!R}),source:r}))}const{FormRow:b}=v.Forms,B=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:p.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:p.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function H(e){const[,n]=t.React.useReducer(function(r){return~r},0);return t.React.createElement(t.ReactNative.View,{style:[B.card,{marginBottom:10}]},t.React.createElement(b,{style:B.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement(b.Icon,{source:e.headerIcon})}),t.React.createElement(b,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:B.actions},e.actions?.().map(function(r){let{icon:l,onPress:o,destructive:i}=r;return t.React.createElement(A,{icon:l,onPress:function(){o(function(){return n()})},style:"card",destructive:i??!1})}))}))}const{showSimpleActionSheet:z}=f.findByProps("showSimpleActionSheet"),{TextStyleSheet:L}=f.findByProps("TextStyleSheet"),O=t.stylesheet.createThemedStyleSheet({text:{...L["text-md/medium"],color:p.semanticColors.TEXT_NORMAL},link:{...L["text-md/bold"],color:p.semanticColors.TEXT_LINK}}),{Text:F,View:K}=v.General;var h;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(h||(h={}));function X(){const e={},[n,r]=t.React.useState(!1),[l,o]=t.React.useState(h.Newest),[i,R]=t.React.useState({}),[d,P]=t.React.useState("");t.React.useEffect(function(){P(""),o(h.Newest)},[]);const I=t.NavigationNative.useNavigation();if(!i.parsed&&!n&&(r(!0),T.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(s){return s.json()}).then(function(s){R({parsed:s}),r(!1)})),I.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(K,{style:{flexDirection:"row-reverse"}},t.React.createElement(A,{onPress:function(){return!n&&R({parsed:void 0})},icon:u.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(A,{onPress:function(){return!n&&z({key:"CardOverflow",options:Object.values(h).map(function(s){return{label:s,onPress:function(){return o(s)}}})})},icon:u.getAssetIDByName("ic_filter"),style:"header"}))}}),n||!i.parsed)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let y=i.parsed.filter(function(s){return s.name?.toLowerCase().includes(d)||s.authors?.some(function(a){return a.name?.toLowerCase().includes(d)})||s.description?.toLowerCase().includes(d)});return[h.Alphabetical,h.ReverseAlphabetical].includes(l)&&(y=y.sort(function(s,a){return s.name<a.name?-1:s.name>a.name?1:0})),[h.ReverseAlphabetical,h.Newest].includes(l)&&y.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(v.Search,{style:{marginBottom:10},onChangeText:function(s){return P(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:y,renderItem:function(s){let{item:a,index:m}=s;return t.React.createElement(H,{index:m,headerLabel:t.React.createElement(F,{style:O.text},a.name,a.authors[0]&&" by ",...a.authors.map(function(c,E,g){return t.React.createElement(t.React.Fragment,null,t.React.createElement(F,{onPress:function(){return $(c.id)},style:O.link},c.name),E!==g.length-1&&", ")})),headerIcon:u.getAssetIDByName(a.vendetta.icon),descriptionLabel:a.description,actions:function(){const c=`https://vd-plugins.github.io/proxy/${a.vendetta.original}`,E=G.plugins.plugins[c];return E?[E.manifest.hash!==a.hash&&{icon:u.getAssetIDByName("ic_sync_24px"),onPress:async function(g){if(!e[c]){e[c]=!0;try{await U(c),S.showToast(`Successfully updated ${a.name}.`,u.getAssetIDByName("ic_sync_24px"))}catch{S.showToast(`Failed to update ${a.name}!`,u.getAssetIDByName("Small"))}delete e[c],g()}}},{icon:u.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(g){if(!e[c]){e[c]=!0;try{w.removePlugin(c),S.showToast(`Successfully deleted ${a.name}.`,u.getAssetIDByName("ic_message_delete"))}catch{S.showToast(`Failed to delete ${a.name}!`,u.getAssetIDByName("Small"))}delete e[c],g()}}}].filter(function(g){return!!g}):[{icon:u.getAssetIDByName("ic_download_24px"),onPress:async function(g){if(!e[c]){e[c]=!0;try{await w.installPlugin(c),S.showToast(`Successfully installed ${a.name}.`,u.getAssetIDByName("toast_image_saved"))}catch(ne){S.showToast(ne?.message??`Failed to install ${a.name}!`,u.getAssetIDByName("Small"))}delete e[c],g()}}}]}})}})}const{FormRow:C}=v.Forms;function Y(){const e=t.NavigationNative.useNavigation();return React.createElement(v.ErrorBoundary,null,React.createElement(C,{label:"Plugin Browser",leading:React.createElement(C.Icon,{source:u.getAssetIDByName("ic_search_items_24px")}),trailing:C.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:X})}}))}const{FormSection:W}=v.Forms,q=f.findByName("UserSettingsOverviewWrapper",!1);function J(){let e=[],n=_.after("default",q,function(r,l){n();const o=T.findInReactTree(l.props.children,function(i){return i.type&&i.type.name==="UserSettingsOverview"});e.push(_.after("render",o.type.prototype,function(i,R){let{props:{children:d}}=R;const P=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];d=T.findInReactTree(d,function(y){return y.children[1].type===W}).children;const I=d.findIndex(function(y){return P.includes(y?.props.label)});d.splice(I===-1?4:I,0,React.createElement(Y,null))}))},!0);return function(){return e.forEach(function(r){return r()})}}const Q=f.findByStoreName("UserStore"),{showUserProfile:Z}=f.findByProps("showUserProfile"),{fetchProfile:ee}=f.findByProps("fetchProfile");async function U(e){const n=e.enabled;for(let r=0;r<2;r++)n&&w.stopPlugin(e.id,!1),await w.fetchPlugin(e.id),n&&await w.startPlugin(e.id)}async function $(e){Q.getUser(e)||await ee(e),Z({userId:e})}let M;var te={onLoad:function(){return M=J()},onUnload:function(){return M?.()}};return N.default=te,N.openProfile=$,N.refetchPlugin=U,Object.defineProperty(N,"__esModule",{value:!0}),N})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.ui.toasts);
