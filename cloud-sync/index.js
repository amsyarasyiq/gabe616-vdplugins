(function(f,de,A,C,D,B,R,s,L,t,y,d,h,k,ge,fe,ye){"use strict";const{TextStyleSheet:he}=d.findByProps("TextStyleSheet"),{View:N,Text:U,Pressable:Se}=y.General,{FormRow:pe}=y.Forms;d.find(function(e){return e.render?.name==="ActionSheet"}),d.findByProps("openLazy","hideActionSheet"),d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function Re(e){const n=d.findByProps("colors","meta"),a=d.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(a.theme,e)}function Ee(e){let{title:n,onPress:a,icon:i}=e;const l=t.stylesheet.createThemedStyleSheet({androidRipple:{color:h.semanticColors.ANDROID_RIPPLE},mainText:{fontFamily:t.constants.Fonts.PRIMARY_SEMIBOLD,fontSize:14,includeFontPadding:!1,letterSpacing:void 0,lineHeight:18,textTransform:"none",color:h.semanticColors.HEADER_SECONDARY},icon:{height:14,tintColor:h.semanticColors.HEADER_SECONDARY}}),r=a?Se:N;return t.React.createElement(r,{android_ripple:l.androidRipple,disabled:!1,accessibilityRole:"button",onPress:a,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&t.React.createElement(N,{style:{marginRight:4}},t.React.createElement(pe.Icon,{style:l.icon,source:i,size:"small"})),t.React.createElement(U,{style:l.mainText},n))}function M(e){let{title:n,onTitlePress:a,icon:i,children:l,padding:r}=e;const u=t.stylesheet.createThemedStyleSheet({main:{backgroundColor:h.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return t.React.createElement(N,{style:{marginHorizontal:16,marginTop:16}},t.React.createElement(Ee,{title:n,onPress:a,icon:i}),t.React.createElement(N,{style:u.main},r?t.React.createElement(N,{style:{paddingHorizontal:16,paddingVertical:16}},l):l))}function Te(e){let{addPadding:n}=e;const a=t.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:h.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return t.React.createElement(N,{style:[{marginTop:16,marginBottom:16},n&&{marginHorizontal:16}]},t.React.createElement(N,{style:a.line}))}var Y;(function(e){function n(i){let{children:l,onPress:r}=i;return t.React.createElement(ve,{variant:"text-md/bold",onPress:r},l)}e.Bold=n;function a(i){let{children:l,onPress:r}=i;return t.React.createElement(U,{style:{textDecorationLine:"underline"},onPress:r},l)}e.Underline=a})(Y||(Y={}));function ve(e){let{variant:n,lineClamp:a,color:i,align:l,style:r,onPress:u,getChildren:g,children:o,liveUpdate:v}=e;const[I,T]=t.React.useReducer(function(w){return~w},0),E=new Date().setMilliseconds(1e3);return v&&setTimeout(function(){return T()},E-Date.now()),t.React.createElement(U,{style:[n?he[n]:{},i?{color:Re(h.semanticColors[i])}:{},l?{textAlign:l}:{},r??{}],numberOfLines:a,onPress:u},g?.()??o)}function K(e){let{onPress:n,icon:a,style:i,destructive:l}=e;const r=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:h.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:h.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:h.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?r.headerStyleIcon:r.cardStyleIcon:i,l&&r.destructiveIcon].filter(function(u){return!!u}),source:a}))}const{View:Ie,Text:X}=y.General,{TextStyleSheet:J}=d.findByProps("TextStyleSheet"),W=t.stylesheet.createThemedStyleSheet({count:{...J["text-lg/bold"],color:h.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...J["text-md/medium"],color:h.semanticColors.TEXT_MUTED,textAlign:"center"}});function q(e){let{subtitle:n,count:a,contents:i}=e;return React.createElement(Ie,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(X,{style:W.count},a),React.createElement(X,{style:W.subtitle},n))}const _="https://vd-cloudsync.nexpid.workers.dev/",Z={clientId:"1120793656878714913",redirectURL:`${_}api/oauth2-response`};async function we(e){const n=await fetch(`${_}api/oauth2-response?code=${encodeURIComponent(e)}&vendetta=true`);if(n.status===200)return await n.text();throw(await n.json())?.message}async function Ce(){if(!c.authorization)return;const e=await fetch(`${_}api/get-data`,{headers:{authorization:c.authorization}});if(e.status===200)return await e.json();throw(await e.json())?.message}async function Q(e){if(!c.authorization)return;const n=await fetch(`${_}api/sync-data`,{method:"POST",headers:{authorization:c.authorization,"content-type":"application/json"},body:JSON.stringify(e)});if(n.status===200)return await n.json();throw(await n.json())?.message}async function Ne(){if(!c.authorization)return;const e=await fetch(`${_}api/delete-data`,{method:"DELETE",headers:{authorization:c.authorization}});if(e.status===200)return await e.json();throw(await e.json())?.message}const{pushModal:be,popModal:me}=d.findByProps("pushModal","popModal"),Pe=d.findByName("OAuth2AuthorizeModal");function Ae(){be({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Pe,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:Z.clientId,redirectUri:Z.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:n}=e;try{const a=new URL(n).searchParams.get("code"),i=await we(a);c.authorization=i,V(),R.showToast("Successfully authenticated",s.getAssetIDByName("Check"))}catch(a){R.showToast(a?.message??a?.toString()??"An error occured during authentication",s.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return me("oauth2-authorize")}},closable:!0}})}const De=window.nativeModuleProxy.BundleUpdaterManager;async function ee(){const e={themes:[],plugins:[]};for(const n of Object.values(D.plugins)){const a=c.pluginSettings[n.id];if(a?.syncPlugin===!1)continue;const i=a?.syncStorage===!1?{}:await A.createMMKVBackend(n.id).get();e.plugins.push({id:n.id,enabled:n.enabled,options:i})}for(const n of Object.values(B.themes))e.themes.push({id:n.id,enabled:n.selected});return e}async function Be(e){if(!p.save)return;let n=!1;const a=p.save.sync.plugins.filter(function(o){return!Object.keys(D.plugins).includes(o.id)&&!o.id.includes("cloud-sync")}),i=a.filter(function(o){return!G(o.id)});let l=!0;i[0]&&await O(!0,"Unproxied Plugins",`Do you want to install **${i.length}** unproxied plugin${i.length!==1?"s":""}? Unproxied plugins haven't been verified by Vendetta staff and thus possibly dangerous. Are you sure you want to continue?`,"Proceed","Skip",void 0,async function(){l=!1});const r=a.filter(function(o){return l?!0:G(o.id)});r.length>0&&await O(e,"Install Plugins",`Would you like to install **${r.length}** new plugin${r.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const o of a)A.createMMKVBackend(o.id).set(o.options),await D.installPlugin(o.id,o.enabled);R.showToast("Synced plugins",s.getAssetIDByName("Check"))});let u;const g=p.save.sync.themes.filter(function(o){return!Object.keys(B.themes).includes(o.id)});g.length>0&&await O(e,"Install Themes",`Would you like to install **${g.length}** new theme${g.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const o of g)o.enabled&&(u=o.id),await B.installTheme(o.id);R.showToast("Synced themes",s.getAssetIDByName("Check"))}),u&&await O(e,"Reload Required","A reload is required to apply the theme. Would you like to reload?","Reload","Skip",async function(){await B.fetchTheme(u,!0),De.reload()}),n||R.showToast("Nothing to sync",s.getAssetIDByName("ic_sync_24px"))}const te=d.findByProps("isTablet"),{Text:_e,View:Oe}=y.General,{FormRow:$e}=y.Forms,{TextStyleSheet:ne}=d.findByProps("TextStyleSheet"),ae=t.stylesheet.createThemedStyleSheet({text:{...ne["text-md/medium"],color:h.semanticColors.TEXT_NORMAL},button:{...ne["text-md/medium"],color:h.semanticColors.TEXT_NORMAL,borderRadius:8}});function xe(){const[e,n]=t.React.useState({});return c.authorization?t.React.createElement(Oe,{style:{flexDirection:te.isTablet?"row":"column",justifyContent:"flex-end"}},[{text:"Sync Data",onPress:async function(a){a(!0);try{p.save=await Q(await ee()),m(),R.showToast("Successfully synced data",s.getAssetIDByName("Check"))}catch(i){R.showToast(`Failed to sync data: ${i}`,s.getAssetIDByName("Small"))}a(!1)}},{text:"Load Data",onPress:async function(a){a(!0);try{await Be(!0)}catch(i){console.log("ZOINKS",i)}a(!1)}}].map(function(a,i){const l=i!==0?8:0;return t.React.createElement(y.Button,{text:a.text,color:"green",size:"small",onPress:function(){return!e[i]&&a.onPress(function(r){n({...e,[i]:!!r})})},trailing:t.React.createElement($e.Icon,{source:s.getAssetIDByName("Check")}),loading:e[i],style:{...ae.button,...te.isTablet?{marginLeft:l}:{marginTop:l}}})})):t.React.createElement(_e,{style:{...ae.text,textAlign:"center"}},"Authenticate first to manage your data")}const{FormSwitchRow:ie}=y.Forms;function Me(){const[e,n]=t.React.useState(""),[,a]=t.React.useReducer(function(r){return~r},0);t.React.useEffect(function(){n("")},[]),A.useProxy(c);const i=t.NavigationNative.useNavigation(),l=i.addListener("focus",function(){l(),i.setOptions({title:"Plugin Settings",headerRight:function(){return t.React.createElement(K,{onPress:function(){return L.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return c.pluginSettings={}}})},icon:s.getAssetIDByName("ic_message_delete"),style:"header"})}})});return t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(y.Search,{style:{marginBottom:10},onChangeText:function(r){return n(r.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(D.plugins).filter(function(r){return r[1].manifest.name?.toLowerCase().includes(e)}),renderItem:function(r){let{item:[u,g]}=r;const o=c.pluginSettings[u]??{syncPlugin:!0,syncStorage:!0},v=function(){o.syncPlugin===!0&&o.syncStorage===!0?delete c.pluginSettings[u]:c.pluginSettings[u]=o,a()};return t.React.createElement(y.Summary,{label:g.manifest.name,icon:g.manifest.vendetta.icon??":3"},t.React.createElement(ie,{label:"Sync Plugin",onValueChange:function(){o.syncPlugin=!o.syncPlugin,v()},value:o.syncPlugin}),t.React.createElement(ie,{label:"Sync Plugin Storage",onValueChange:function(){o.syncStorage=!o.syncStorage,v()},value:o.syncStorage}))}})}var re={github:{url:"https://github.com/Gabe616/VendettaPlugins/"}};const{showSimpleActionSheet:Le}=d.findByProps("showSimpleActionSheet"),ke=d.findByStoreName("UserStore");function Ue(){const e=ye.getDebugInfo(),n=t.ReactNative.NativeModules.InfoDictionaryManager??t.ReactNative.NativeModules.RTNClientInfoManager;return`Device: ${e.os.name==="iOS"?e.device.codename:`${e.device.brand} ${e.device.model}`}
Model: ${e.device.model}
Manufacturer: ${e.device.manufacturer}
Brand: ${e.device.brand}

OS: ${e.os.name}
Version: ${e.os.version}

Discord Branch: ${n.ReleaseChannel}
Discord Version: ${e.discord.version}
Discord Build: ${e.discord.build}
Vendetta Version: ${e.vendetta.version}

React Version: ${e.react.version}
Hermes Bytecode: ${e.hermes.bytecodeVersion}`}function oe(e){const n=ke.getCurrentUser(),a=new URLSearchParams;for(const[i,l]of Object.entries(e))a.set(i,l);return a.set("discord-username",`@${n.username}${n.discriminator!=="0"?`#${n.discriminator}`:""}`),console.log(`${re.github.url}issues/new?${a.toString()}`),`${re.github.url}issues/new?${a.toString()}`}const ze=function(e){return Le({key:"CardOverflow",header:{title:"GitHub Reports"},options:[{label:"Copy bug report link",icon:s.getAssetIDByName("copy"),onPress:function(){t.clipboard.setString(oe({title:`bug(${e}): `,template:"bug_report.yml",labels:"bug",sysinfo:Ue()})),R.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}},{label:"Copy feature suggestion link",icon:s.getAssetIDByName("copy"),onPress:function(){t.clipboard.setString(oe({title:`suggest(${e}): `,labels:"suggestion",template:"suggestion.yml"})),R.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}}]})},{ScrollView:Fe,View:Ve}=y.General,{FormRow:S,FormSwitchRow:ce}=y.Forms;function z(){const[,e]=t.React.useReducer(function(i){return~i},0);A.useProxy(c),f.cacheUpd.push(e),t.React.useEffect(function(){return function(){f.cacheUpd=f.cacheUpd.filter(function(i){return i!==e})}},[]);const n=t.NavigationNative.useNavigation(),a=n.addListener("focus",function(){a(),n.setOptions({headerRight:function(){return t.React.createElement(K,{icon:s.getAssetIDByName("ic_report_message"),style:"header",onPress:function(){return ze("cloud-sync")}})}})});return t.React.createElement(Fe,null,t.React.createElement(M,{title:"Current Data",icon:s.getAssetIDByName("ic_contact_sync"),padding:!0},t.React.createElement(Ve,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},t.React.createElement(q,{count:p.save?.sync?.plugins?.length??"-",subtitle:"plugins",contents:2}),t.React.createElement(q,{count:p.save?.sync?.themes?.length??"-",subtitle:"themes",contents:2}))),t.React.createElement(M,{title:"Settings",icon:s.getAssetIDByName("ic_cog_24px")},t.React.createElement(ce,{label:"Auto Sync",subLabel:"Automatically sync data to cloud",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return c.autoSync=!c.autoSync},value:c.autoSync}),t.React.createElement(ce,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return c.addToSettings=!c.addToSettings},value:c.addToSettings}),t.React.createElement(S,{label:"Plugin Settings",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("debug")}),trailing:t.React.createElement(S.Arrow,null),onPress:function(){return n.push("VendettaCustomPage",{render:Me})}})),t.React.createElement(M,{title:"Authentication",icon:s.getAssetIDByName("lock")},c.authorization?t.React.createElement(t.React.Fragment,null,t.React.createElement(S,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("ic_logout_24px")}),onPress:function(){delete c.authorization,delete p.save,m(),R.showToast("Successfully logged out",s.getAssetIDByName("ic_logout_24px"))}}),t.React.createElement(S,{label:"Delete data",subLabel:"Deletes your data and logs you out of CloudSync",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("trash")}),onPress:async function(){await Ne(),delete c.authorization,delete p.save,m(),R.showToast("Successfully deleted data",s.getAssetIDByName("trash"))}})):t.React.createElement(S,{label:"Authenticate",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("copy")}),trailing:S.Arrow,onPress:Ae})),t.React.createElement(M,{title:"Data Management",icon:s.getAssetIDByName("ic_message_edit"),padding:!0},t.React.createElement(xe,null),c.authorization&&t.React.createElement(t.React.Fragment,null,t.React.createElement(Te,null),t.React.createElement(S,{label:"Copy Data as JSON",leading:t.React.createElement(S.Icon,{source:s.getAssetIDByName("copy")}),onPress:function(){t.clipboard.setString(JSON.stringify(p.save??{},void 0,3)),R.showToast("Copied",s.getAssetIDByName("Check"))}}))))}let se=0;function Ge(e){clearTimeout(se),se=setTimeout(e,1500)}const{FormRow:F}=y.Forms;function je(){const e=t.NavigationNative.useNavigation();return React.createElement(y.ErrorBoundary,null,React.createElement(F,{label:"Cloud Sync",leading:React.createElement(F.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),trailing:F.Arrow,onPress:function(){return e.push("VendettaCustomPage",{title:"CloudSync",render:z})}}))}const{FormSection:He}=y.Forms,Ye=d.findByName("getScreens"),Ke=d.findByName("UserSettingsOverviewWrapper",!1),Xe=d.findByName("SettingsOverviewScreen",!1),b=d.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),Je=d.findByProps("getSettingTitleConfig"),We=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:h.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function qe(e,n,a){const i=[],l=C.after("default",Ke,function(r,u){l();const g=k.findInReactTree(u.props.children,function(o){return o.type&&o.type.name==="UserSettingsOverview"});i.push(C.after("render",g.type.prototype,function(o,v){let{props:{children:I}}=v;const T=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];I=k.findInReactTree(I,function(w){return w.children[1].type===He}).children;const E=I.findIndex(function(w){return T.includes(w?.props.label)});e()&&I.splice(E===-1?4:E,0,n())}))},!0);if(i.push(l),Ye&&a){const r=`VENDETTA_PLUGIN_${t.lodash.snakeCase(a.key).toUpperCase()}`;i.push(C.after("default",Xe,function(I,T){const E=T.props.sections,w=E.findIndex(function(x){return x.title==="Vendetta"});if(E[w]&&e()){const x={...E[w]};x.settings=[...x.settings,r],E[w]=x}})),i.push(C.after("getSettingTitleConfig",Je,function(I,T){return{...T,...Object.fromEntries([[r,typeof a.title=="function"?a.title():a.title]])}}));const u=a.page.render,g=t.React.memo(function(I){let{navigation:T}=I;const E=T.addListener("focus",function(){E(),T.setOptions(k.without(a.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:We.container},a.page.noErrorBoundary?t.React.createElement(u,null):t.React.createElement(y.ErrorBoundary,null,t.React.createElement(u,null)))}),o=b.SETTING_RELATIONSHIPS;b.SETTING_RELATIONSHIPS={...o,...Object.fromEntries([[r,null]])};const v=b.SETTING_RENDERER_CONFIGS;b.SETTING_RENDERER_CONFIGS={...v,...Object.fromEntries([[r,{type:"route",icon:a.icon,screen:{route:`VendettaPlugin${t.lodash.chain(a.key).camelCase().upperFirst().value()}`,getComponent:function(){return g}}}]])},i.push(function(){b.SETTING_RELATIONSHIPS=o,b.SETTING_RENDERER_CONFIGS=v})}return function(){return i.forEach(function(r){return r()})}}function Ze(){let e=[];return e.push(qe(function(){return c.addToSettings},function(){return React.createElement(je,null)},{key:ge.plugin.manifest.name,icon:s.getAssetIDByName("ic_contact_sync"),title:"Cloud Sync",page:{title:"CloudSync",render:z}})),function(){return e.forEach(function(n){return n()})}}const c=de.storage,p={};f.cacheUpd=[];function m(){f.cacheUpd.forEach(function(e){return e()})}async function V(){try{p.save=await Ce()}catch{}m()}async function O(e,n,a,i,l,r,u){return e?new Promise(function(g){L.showConfirmationAlert({title:n,content:a,confirmText:i,cancelText:l,confirmColor:"green",isDismissable:!1,onConfirm:function(){return r?r().then(g):g()},onCancel:function(){return u?u().then(g):g()}})}):await r?.()}function G(e){return e.startsWith(fe.PROXY_PREFIX)}const j=async function(){if(!c.autoSync)return;const e=await ee();JSON.stringify(p.save)!==JSON.stringify(e)&&Ge(async function(){p.save=await Q(e),m()})};let P=[],le=!1,H=!1;const ue=function(){P.push(C.after("createMMKVBackend",A,function(e,n){P.push(C.after("set",n,function(){return j()}))}))},$=1;c.autoSync??=!1,c.addToSettings??=!0,c.pluginSettings??={},t.FluxDispatcher.subscribe("I18N_LOAD_SUCCESS",function(){le=!0,H&&ue()});var Qe={onLoad:function(){H=!0,c.authorization&&V(),["installPlugin","startPlugin","stopPlugin","removePlugin"].forEach(function(n){return P.push(C.after(n,D,function(){return j()}))}),["installTheme","selectTheme","removeTheme"].forEach(function(n){return P.push(C.after(n,B,function(){return j()}))}),le&&ue(),P.push(Ze());const e=function(n,a){return L.showConfirmationAlert({title:n,content:a,onConfirm:function(){},confirmText:"Dismiss",confirmColor:"brand",secondaryConfirmText:"Don't show again",onConfirmSecondary:function(){return c.databaseMigrate=$}})};c.databaseMigrate!==$&&window.CSmigrationStage!==$&&(window.CSmigrationStage=$,e("Cloud Sync \u2014 DB Migration Stage 1",`Hey, I'd like to quickly announce that CloudSync will be switching databases soon and your data may get ***deleted***. Make sure to keep an eye on your data for the upcoming weeks!

- nexx`))},onUnload:function(){H=!1,P.forEach(function(e){return e()})},settings:z};return f.cache=p,f.cacheUpdated=m,f.currentMigrationStage=$,f.default=Qe,f.fillCache=V,f.isPluginProxied=G,f.promptOrRun=O,f.vstorage=c,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.storage,vendetta.patcher,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.ui.components,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.constants,vendetta.debug);
